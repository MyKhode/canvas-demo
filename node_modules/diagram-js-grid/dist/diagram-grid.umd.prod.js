!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).DiagramJSGrid=e()}(this,(function(){"use strict";function t(t,e){return function(t,e){e.appendChild(function(t,e){if(t.ownerDocument!==e.ownerDocument)try{return e.ownerDocument.importNode(t,!0)}catch(t){}return t}(t,e))}(e,t),t}var e=2,n={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":e,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":e,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function r(t,r,i){var o=r.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),a=n[o];a?(a===e&&"number"==typeof i&&(i=String(i)+"px"),t.style[o]=i):t.setAttributeNS(null,r,i)}function i(t,e,i){if("string"==typeof e){if(void 0===i)return function(t,e){return n[e]?t.style[e]:t.getAttributeNS(null,e)}(t,e);r(t,e,i)}else!function(t,e){var n,i,o=Object.keys(e);for(n=0;i=o[n];n++)r(t,i,e[i])}(t,e);return t}function o(t){var e=t.parentNode;return e&&e.removeChild(t),t}var a,s={svg:"http://www.w3.org/2000/svg"},c='<svg xmlns="'+s.svg+'"';function l(t){var e=!1;"<svg"===t.substring(0,4)?-1===t.indexOf(s.svg)&&(t=c+t.substring(4)):(t=c+">"+t+"</svg>",e=!0);var n=function(t){var e;return(e=new DOMParser).async=!1,e.parseFromString(t,"text/xml")}(t);if(!e)return n;for(var r=document.createDocumentFragment(),i=n.firstChild;i.firstChild;)r.appendChild(i.firstChild);return r}function u(t,e){var n;return"<"===t.charAt(0)?(n=l(t).firstChild,n=document.importNode(n,!0)):n=document.createElementNS(s.svg,t),e&&i(n,e),n}"undefined"!=typeof document&&((a=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',a.getElementsByTagName("link").length,a=void 0);function d(t,e,n){return n||(n="round"),Math[n](t/e)*e}const f=Object.prototype.toString,g=Object.prototype.hasOwnProperty;function h(t){return r=t,"[object Object]"===f.call(r)&&(e=t,n="waypoints",g.call(e,n));var e,n,r}function p(t){return e={x:t.x+(t.width||0)/2,y:t.y+(t.height||0)/2},{x:Math.round(e.x),y:Math.round(e.y)};var e}function v(t){for(var e=t.waypoints,n=e.reduce((function(t,n,r){var i,o,a=e[r-1];if(a){var s=t[t.length-1],c=s&&s.endLength||0,l=(i=a,o=n,Math.sqrt(Math.pow(i.x-o.x,2)+Math.pow(i.y-o.y,2)));t.push({start:a,end:n,startLength:c,endLength:c+l,length:l})}return t}),[]),r=n.reduce((function(t,e){return t+e.length}),0)/2,i=0,o=n[i];o.endLength<r;)o=n[++i];var a=(r-o.startLength)/o.length;return{x:o.start.x+(o.end.x-o.start.x)*a,y:o.start.y+(o.end.y-o.start.y)*a}}var y=1e5,m=1e5;function b(t,e){this._canvas=t;var n=this;e.on("diagram.init",(function(){n._init(),n.toggle(!0)})),e.on("gridSnapping.toggle",(function(t){var e=t.active;n.toggle(e),n._centerGridAroundViewbox()})),e.on("canvas.viewbox.changed",(function(t){var e=t.viewbox;n._centerGridAroundViewbox(e)}))}return b.prototype._init=function(){var e,n=(e="defs",(this._canvas._svg||document).querySelector(e));n||(n=u("defs"),t(this._canvas._svg,n));var r=this._pattern=u("pattern"),o="djs-grid-pattern-"+Math.trunc(1e6*Math.random());i(r,{id:o,width:10,height:10,patternUnits:"userSpaceOnUse"});var a=this._circle=u("circle");i(a,{cx:.5,cy:.5,r:.5,fill:"#ccc"}),t(r,a),t(n,r),i(this._gfx=u("rect"),{x:-y/2,y:-m/2,width:y,height:m,fill:`url(#${o})`})},b.prototype._centerGridAroundViewbox=function(t){t||(t=this._canvas.viewbox());var e,n=h(e=t)?v(e):p(e);i(this._gfx,{x:-y/2+d(n.x,10),y:-m/2+d(n.y,10)})},b.prototype.isVisible=function(){return this._visible},b.prototype.toggle=function(e){if(void 0===e&&(e=!this._visible),e!==this._visible){var n=this._getParent();e?t(n,this._gfx):function(t){for(var e;e=t.firstChild;)o(e)}(n),this._visible=e}},b.prototype._getParent=function(){return this._canvas.getLayer("djs-grid",-2)},b.$inject=["canvas","eventBus"],{__init__:["grid"],grid:["type",b]}}));
